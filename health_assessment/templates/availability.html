<!DOCTYPE>
<html>

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <title>
        Health Assessment
    </title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <a class="navbar-brand" href="#">Health Assessment</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Link</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Dropdown
                              </a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <a class="dropdown-item" href="#">Action</a>
                        <a class="dropdown-item" href="#">Another action</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="#">Something else here</a>
                    </div>
                </li>
            </ul>
        </div>
    </nav>
    <div class='container-fluid'>
        <div class="row">
            <div class="mx-auto p-4" style="width:80%;" id="availabilityChart">
            </div>
        </div>
        <div class="row mb-3">
            <div class="shadow border border-white p-3 col-md-6 text-left rounded">
                <p>
                    ID Column: Account ID<br>
                    Churn Date: Inactivation Date<br>
                    Snapshot Date: Snapshot Date<br>
                    Target Field: Status<br>
                </p>
            </div>
            <div class="shadow border border-white p-3 col-md-6 text-left rounded">
                <p>
                    History File: history_2000.csv<br>
                    Outcome Data: outcome_date.csv<br>
                    Account Details: company.csv<br>
                    RunId: ahgd875612e78t87ag87cga<br>
                </p>
            </div>
        </div>
        <div class="row">
            <div class="shadow p-3 mb-5 col-md-12 text-center">
                <div class="" style="width:100%;">
                    <button type="submit" class="btn btn-primary" id="goToMetricPage">Confirm</button>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

    <script>
        $(document).ready(function() {
            google.load('visualization', '1.0', {
                'packages': ['corechart']
            });
            google.setOnLoadCallback(getAvailabilityData);

            function getCookie(cname) {
                var name = cname + "=";
                var decodedCookie = decodeURIComponent(document.cookie);
                var ca = decodedCookie.split(';');
                for (var i = 0; i < ca.length; i++) {
                    var c = ca[i];
                    while (c.charAt(0) == ' ') {
                        c = c.substring(1);
                    }
                    if (c.indexOf(name) == 0) {
                        return c.substring(name.length, c.length);
                    }
                }
                return "";
            }

            function drawChart(dataTable) {
                var data = google.visualization.arrayToDataTable(dataTable);

                var options = {
                    title: 'Data Availability',
                    subtitle: 'Available Data For Each Features',
                    curveType: 'function',
                    legend: {
                        position: 'right'
                    },
                    animation: {
                        duration: 1000,
                        startup: true,
                        easing: 'in'
                    },
                    chartArea: {
                        left: 30,
                        top: 20,
                        bottom: 30
                    },
                    width: 1600,
                    height: 560
                };

                var chart = new google.visualization.LineChart(document.getElementById('availabilityChart'));
                chart.draw(data, options);
            }

            function getAvailabilityData() {
                $.ajax({
                    type: 'get',
                    url: '/health/availability/' + getCookie("run_id"),
                    processData: false,
                    contentType: false,
                    success: function(data) {
                        let plotData = [];
                        const cols = [
                            'Year',
                            'Account ID',
                            'Avg Days to Close',
                            'Billing',
                            'CSM Opinion',
                            'CSS Opinion',
                            'Close Rate',
                            'Create Offer Tool',
                            'Default',
                            'GM Tenure',
                            'Inactivation Date',
                            'Last Visit',
                            'Lost Sales',
                            'NPS',
                            'Opinion Scores',
                            'Pricing',
                            'Snapshot Date',
                            'Status',
                            'Tenure',
                            'week'
                        ]
                        plotData.push(cols);

                        for (year in data) {
                            for (month in data[year]) {
                                var temp = [];
                                temp.push(year + "/" + month);
                                temp.push(data[year][month]['Account ID']);
                                temp.push(data[year][month]['Avg Days to Close']);
                                temp.push(data[year][month]['Billing']);
                                temp.push(data[year][month]['CSM Opinion']);
                                temp.push(data[year][month]['CSS Opinion']);
                                temp.push(data[year][month]['Close Rate']);
                                temp.push(data[year][month]['Create Offer Tool']);
                                temp.push(data[year][month]['Default']);
                                temp.push(data[year][month]['GM Tenure']);
                                temp.push(data[year][month]['Inactivation Date']);
                                temp.push(data[year][month]['Last Visit']);
                                temp.push(data[year][month]['Lost Sales']);
                                temp.push(data[year][month]['NPS']);
                                temp.push(data[year][month]['Opinion Scores']);
                                temp.push(data[year][month]['Pricing']);
                                temp.push(data[year][month]['Snapshot Date']);
                                temp.push(data[year][month]['Status']);
                                temp.push(data[year][month]['Tenure']);
                                temp.push(data[year][month]['week']);
                                plotData.push(temp);
                            }
                        }
                        drawChart(plotData);
                    }
                });
            }

            $("#goToMetricPage").click(function(){
                window.location = "/health/metrics-assessment/" + getCookie("run_id")
            })
        })
    </script>
</body>

</html>