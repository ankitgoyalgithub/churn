<html>

<head>
    {% load static %}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <title>
        Health Assessment
    </title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <a class="navbar-brand" href="#">Health Assessment</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"> Reports </span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ml-auto">
                <li id="download-data" class="nav-item active">
                    <a class="nav-link" href="#">Reports <span class="sr-only">(current)</span></a>
                </li>
            </ul>
        </div>
    </nav>
    <div class='container-fluid'>
        <div class="row">
            <nav class="col-md-2 d-none d-md-block bg-light sidebar">
                <div class="sidebar-sticky">
                    <ul class="nav flex-column">
                        <li class="nav-item" id="cluster-insights-button">
                            <a class="nav-link active" href="#">
                                <span data-feather="home"></span> Separation Sensitivity <span
                                    class="sr-only">(current)</span>
                            </a>
                        </li>
                        <li class="nav-item" id="cluster-insights-button">
                            <a class="nav-link active" href="#" data-toggle="modal" data-target=".bd-example-modal-lg">
                                <span data-feather="home"></span> Help <span class="sr-only"></span>
                            </a>
                            <div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog"
                                aria-labelledby="myLargeModalLabel" aria-hidden="true">
                                <div class="modal-dialog modal-lg">
                                    <div class="modal-content">
                                        <img style="width:100%;" alt="How to Read the Graphs"
                                            src="{% static 'assessment_help.png' %}">
                                    </div>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </nav>
            <div class="col-md-10">
                <h2>Bins</h2>
                <div class="row">
                    <div class="col-md-4">
                        <div id="chart1">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div id="chart2">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div id="chart3">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        <div id="chart4">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div id="chart5">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div id="chart6">
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-4">
                        <div id="chart7">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div id="chart8">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div id="chart9">
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-4">
                        <div id="chart10">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div id="chart11">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div id="chart12">
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <h2>Predictive Power</h2>
                        <div class="table-responsive">
                            <table class="table table-striped table-sm">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Feature</th>
                                        <th>Score</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>1</td>
                                        <td>Average Days To Close</td>
                                        <td>18.636541</td>
                                    </tr>
                                    <tr>
                                        <td>2</td>
                                        <td>Billing</td>
                                        <td>0.0</td>
                                    </tr>
                                    <tr>
                                        <td>3</td>
                                        <td>CSM Opinion</td>
                                        <td>0.0</td>
                                    </tr>
                                    <tr>
                                        <td>4</td>
                                        <td>CSS Opinion</td>
                                        <td>0.0</td>
                                    </tr>
                                    <tr>
                                        <td>5</td>
                                        <td>Close Rate</td>
                                        <td>-7.185447</td>
                                    </tr>
                                    <tr>
                                        <td>6</td>
                                        <td>Create Offer Tool</td>
                                        <td>29.146973</td>
                                    </tr>
                                    <tr>
                                        <td>7</td>
                                        <td>GM Tenure</td>
                                        <td>2.498819</td>
                                    </tr>
                                    <tr>
                                        <td>8</td>
                                        <td>Last Visit</td>
                                        <td>21.415999</td>
                                    </tr>
                                    <tr>
                                        <td>9</td>
                                        <td>Lost Sales</td>
                                        <td>30.274088</td>
                                    </tr>
                                    <tr>
                                        <td>10</td>
                                        <td>NPS</td>
                                        <td>2.294849</td>
                                    </tr>
                                    <tr>
                                        <td>11</td>
                                        <td>Pricing</td>
                                        <td>18.063972</td>
                                    </tr>
                                    <tr>
                                        <td>12</td>
                                        <td>Tenure</td>
                                        <td>35.273631</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>

    <script>
        $(document).ready(function () {
            google.load('visualization', '1.0', {
                'packages': ['corechart']
            });
            google.setOnLoadCallback(getAssessmentData);

            function getCookie(cname) {
                var name = cname + "=";
                var decodedCookie = decodeURIComponent(document.cookie);
                var ca = decodedCookie.split(';');
                for (var i = 0; i < ca.length; i++) {
                    var c = ca[i];
                    while (c.charAt(0) == ' ') {
                        c = c.substring(1);
                    }
                    if (c.indexOf(name) == 0) {
                        return c.substring(name.length, c.length);
                    }
                }
                return "";
            }

            $("#download-data").click(function (event) {
                window.location = '/health/reports/' + getCookie("run_id");
            })

            // Assessment API Call
            function getAssessmentData() {
                $.ajax({
                    type: 'get',
                    url: '/health/assessment/' + getCookie("run_id"),
                    processData: false,
                    contentType: false,
                    success: function (data) {
                        const colors = ["#3366CC", "#DC3912", "#ff9900", "#109618", "#990099"];
                        let chartCounter = 1;
                        for (keys in data["ks_dict"]) {
                            var dataTable = [['Bin', 'Lift', {
                                role: "style"
                            }]];
                            for (let i = 0; i < data["ks_dict"][keys].length; i++) {
                                dataTable.push([data["ks_dict"][keys][i]["bin"], data["ks_dict"][keys][i]["value"], colors[i]]);
                            }

                            var chartData = google.visualization.arrayToDataTable(dataTable);

                            var chartOptions = {
                                title: keys,
                                curveType: 'function',
                                legend: {
                                    position: 'right'
                                },
                                vAxis: {
                                    title: 'Lift Over Average Risk'
                                }
                            };

                            var chart = new google.visualization.ColumnChart(document.getElementById('chart' + chartCounter.toString()));
                            chartCounter = chartCounter + 1
                            chart.draw(chartData, chartOptions);
                        }
                    }
                });
            }

        }) // End of Document Ready
    </script>
</body>

</html>